# =============================================================================
# Navidrome Ingress Routes - External Access to Music Streaming Server
# =============================================================================
# 
# These IngressRoutes provide external web access to the Navidrome music
# streaming server through Traefik. They implement:
# - Automatic HTTPS redirects for security
# - SSL certificate management via Let's Encrypt
# - Security headers for enhanced protection
# - Multiple domain support (IP and custom domains)
# 
# Navidrome serves as your personal music streaming service, accessible from
# anywhere with proper authentication. The routes support:
# 1. Web interface for browser-based music streaming
# 2. Subsonic API for mobile app compatibility
# 3. Multi-user access with individual libraries
# 4. External streaming from any location
# 
# Documentation:
# - Traefik IngressRoute: https://doc.traefik.io/traefik/routing/providers/kubernetes-crd/
# - Let's Encrypt: https://letsencrypt.org/docs/
# - sslip.io: https://sslip.io/ (wildcard DNS for any IP)
# =============================================================================
# =============================================================================
# Navidrome HTTP Route - Automatic HTTPS Redirect
# =============================================================================
# This route handles all HTTP (port 80) traffic to Navidrome and redirects
# it to HTTPS for secure communication. This ensures all music streaming
# traffic is encrypted, protecting credentials and personal data.
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: navidrome-http # Unique name for this ingress route
  namespace: media # Must match the namespace of target service
spec:
  # Entry points define which Traefik ports this route listens on
  entryPoints:
    - web # HTTP entry point (port 80)
  # Routes define the matching rules and actions
  routes:
    # Route for IP-based access (useful for local/development access)
    - match: Host(`navidrome.<YOUR_PUBLIC_IP>.sslip.io`)
      kind: Rule # Standard routing rule
      middlewares:
        - name: redirect-https # Apply HTTPS redirect middleware
      services:
        - name: navidrome # Target service name
          port: 4530 # Service port (not the container port)
    # Route for custom domain access (replace <YOUR_DOMAIN> with actual domain)
    - match: Host(`navidrome.<YOUR_DOMAIN>.sslip.io`)
      kind: Rule
      services:
        - name: navidrome
          port: 4530
---
# =============================================================================
# Navidrome HTTPS Route - Secure Music Streaming Access
# =============================================================================
# This route handles all HTTPS (port 443) traffic to Navidrome, providing
# secure access to the music streaming service with automatic SSL certificates.
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: navidrome-https # Unique name for this ingress route
  namespace: media # Must match the namespace of target service
spec:
  # Entry points define which Traefik ports this route listens on
  entryPoints:
    - websecure # HTTPS entry point (port 443)
  # Routes define the matching rules and actions
  routes:
    # Route for IP-based secure access
    - match: Host(`navidrome.<YOUR_PUBLIC_IP>.sslip.io`)
      kind: Rule # Standard routing rule
      middlewares:
        - name: security-headers # Apply security headers middleware
      services:
        - name: navidrome # Target service name
          port: 4530 # Service port for Navidrome
    # Route for custom domain secure access
    - match: Host(`navidrome.<YOUR_DOMAIN>.sslip.io`)
      kind: Rule
      middlewares:
        - name: security-headers # Apply security headers middleware
      services:
        - name: navidrome
          port: 4530
  # TLS configuration for automatic SSL certificate management
  tls:
    certResolver: letsencrypt # Use Let's Encrypt for automatic certificates
